import{s as P,n as b,d as a,i as h,b as E,l as m,o as D,g,c as p,e as w,j as x,h as v,q as I,a as T,p as k,f as q,t as A}from"../chunks/scheduler.-13gY_0V.js";import{S as V,i as j}from"../chunks/index.CL68AUYa.js";import{g as C}from"../chunks/entry.Cd0yNLQu.js";import{s as S}from"../chunks/client.M3ojON4v.js";function L(_){let n,l,s,r="Signing you in...",c,t,o="Please wait while we complete your authentication";return{c(){n=v("div"),l=x(),s=v("h2"),s.textContent=r,c=x(),t=v("p"),t.textContent=o,this.h()},l(e){n=p(e,"DIV",{class:!0}),w(n).forEach(a),l=g(e),s=p(e,"H2",{class:!0,"data-svelte-h":!0}),k(s)!=="svelte-q22fmj"&&(s.textContent=r),c=g(e),t=p(e,"P",{class:!0,"data-svelte-h":!0}),k(t)!=="svelte-huojro"&&(t.textContent=o),this.h()},h(){m(n,"class","spinner svelte-1x5kdm0"),m(s,"class","svelte-1x5kdm0"),m(t,"class","svelte-1x5kdm0")},m(e,d){h(e,n,d),h(e,l,d),h(e,s,d),h(e,c,d),h(e,t,d)},p:b,d(e){e&&(a(n),a(l),a(s),a(c),a(t))}}}function R(_){let n,l="âŒ",s,r,c="Authentication Failed",t,o,e,d,u,y="Redirecting to sign in page...";return{c(){n=v("div"),n.textContent=l,s=x(),r=v("h2"),r.textContent=c,t=x(),o=v("p"),e=A(_[0]),d=x(),u=v("p"),u.textContent=y,this.h()},l(i){n=p(i,"DIV",{class:!0,"data-svelte-h":!0}),k(n)!=="svelte-7ohcvp"&&(n.textContent=l),s=g(i),r=p(i,"H2",{class:!0,"data-svelte-h":!0}),k(r)!=="svelte-1v8evsd"&&(r.textContent=c),t=g(i),o=p(i,"P",{class:!0});var f=w(o);e=q(f,_[0]),f.forEach(a),d=g(i),u=p(i,"P",{class:!0,"data-svelte-h":!0}),k(u)!=="svelte-10ysdnm"&&(u.textContent=y),this.h()},h(){m(n,"class","error-icon svelte-1x5kdm0"),m(r,"class","svelte-1x5kdm0"),m(o,"class","error-message svelte-1x5kdm0"),m(u,"class","redirect-notice svelte-1x5kdm0")},m(i,f){h(i,n,f),h(i,s,f),h(i,r,f),h(i,t,f),h(i,o,f),E(o,e),h(i,d,f),h(i,u,f)},p(i,f){f&1&&T(e,i[0])},d(i){i&&(a(n),a(s),a(r),a(t),a(o),a(d),a(u))}}}function U(_){let n,l,s;function r(o,e){return o[0]?R:L}let c=r(_),t=c(_);return{c(){n=x(),l=v("div"),s=v("div"),t.c(),this.h()},l(o){D("svelte-1eqy6ol",document.head).forEach(a),n=g(o),l=p(o,"DIV",{class:!0});var d=w(l);s=p(d,"DIV",{class:!0});var u=w(s);t.l(u),u.forEach(a),d.forEach(a),this.h()},h(){document.title="Signing In... - Deutschlern",m(s,"class","loading-content svelte-1x5kdm0"),m(l,"class","loading-page svelte-1x5kdm0")},m(o,e){h(o,n,e),h(o,l,e),E(l,s),t.m(s,null)},p(o,[e]){c===(c=r(o))&&t?t.p(o,e):(t.d(1),t=c(o),t&&(t.c(),t.m(s,null)))},i:b,o:b,d(o){o&&(a(n),a(l)),t.d()}}}function H(_,n,l){let s=null;return I(async()=>{try{const r=new URLSearchParams(window.location.hash.substring(1)),c=r.get("access_token"),t=r.get("refresh_token");if(c&&t){console.log("OAuth tokens found in URL, setting session...");const{data:d,error:u}=await S.auth.setSession({access_token:c,refresh_token:t});if(u){console.error("Error setting session:",u),l(0,s=u.message),setTimeout(()=>C("/login"),3e3);return}if(d.session){console.log("Session set successfully, redirecting to dashboard..."),window.location.hash="",window.location.href="/";return}}const{data:{session:o},error:e}=await S.auth.getSession();if(e){console.error("Auth callback error:",e),l(0,s=e.message),setTimeout(()=>C("/login"),3e3);return}o?(console.log("Login successful, redirecting to dashboard..."),window.location.href="/"):(console.log("No session found, redirecting to login..."),C("/login"))}catch(r){console.error("Unexpected error during auth callback:",r),l(0,s="An unexpected error occurred"),setTimeout(()=>C("/login"),3e3)}}),[s]}class z extends V{constructor(n){super(),j(this,n,H,U,P,{})}}export{z as component};
