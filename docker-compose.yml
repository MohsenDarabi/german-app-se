services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    ports:
      - "5173:5173"
    volumes:
      # Mount source code for hot reload
      - ./apps:/app/apps
      - ./packages:/app/packages
      - ./content:/app/content
      # Exclude node_modules from host mounts (use container's installed deps)
      - /app/node_modules
      - /app/apps/web/node_modules
      - /app/packages/ui/node_modules
      - /app/packages/content-model/node_modules
      - /app/packages/srs-engine/node_modules
      - /app/packages/utils/node_modules
    env_file:
      # Root .env as fallback, apps/web/.env takes priority (loaded last)
      - path: ./.env
        required: false
      - path: ./apps/web/.env
        required: false
    environment:
      - NODE_ENV=development
    stdin_open: true
    tty: true
